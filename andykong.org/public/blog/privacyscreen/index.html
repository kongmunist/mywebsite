<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

    
        <meta name="author" content="Andy Kong">
        <meta name="title" content="Privacy screen">
        <meta name="description" content="Only cool kids can see this laptop!">
        <meta name="keywords" content=" facerecognition,  miniprojectlog, ">

        <title>
            Privacy screen | Andy Kong
        </title>
    

    <style>
        /* ========================================
           Typography Scale (1.25 ratio)
           Base: 1rem (16px)
           ======================================== */
        
        body {
            counter-reset: h1counter h2counter;
        }

        h1:not(.title) {
            padding-left: 12px;
            margin-left: -12px;
            border-left: 8px groove #DBAD80;
            font-size: 1.75rem;
            counter-reset: h2counter;
        }

        h1:not(.title)::before {
            counter-increment: h1counter;
            content: counter(h1counter) ". ";
        }

        .blogpage > h2 {
            font-size: 1.4rem;
        }

        .blogpage > h2::before {
            counter-increment: h2counter;
            content: counter(h1counter) "." counter(h2counter) "  ";
        }

        .blogpage p {
            font-size: 1rem;
            line-height: 1.6;
        }

        .blogpage img{
            max-width: 100%;
            max-height: 50vh;
            height: auto;
            width: auto;
            display: block !important;
            margin: 0 auto !important;
            border-radius: 0;
        }

        .blogpage h1, .blogpage h2{
            color: #E0B890;
        }

        .toc {
            padding-left: 12px;
            margin-left: -12px;
            border-left: 8px ridge #DBAD80;
            color: inherit;
            text-decoration: none;
            font-size: 1rem;
        }
    </style>




    <style type="text/css">
        /* Atkinson Hyperlegible */
        /* latin-ext
        @font-face {
          font-family: 'Atkinson Hyperlegible';
          font-style: normal;
          font-weight: 400;
          src: url("/static/atkhyp_latext.woff2") format('woff2');
          unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
        } */
        /* latin */
        @font-face {
          font-family: 'Atkinson Hyperlegible';
          font-style: normal;
          font-weight: 400;
          src: url("/static/atkhyp_lat.woff2") format('woff2');
          unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
        }


    </style>
    <link rel="stylesheet" type="text/css" href="/static/bootstrap.min.css">

    <script src="/static/fontawesome.js" defer></script>

    <script src="/static/instantpage-5.1.0.js" type="module" defer></script>




    <style>
        body {
            background: #202222;
            font-size: 1.1em;
            font-family: 'Atkinson Hyperlegible', sans-serif;
            color: #FAEADB;
            overflow-x: hidden;

            word-spacing: 0.03em;
        }

        .navlinks{
            font-family: 'Atkinson Hyperlegible';
            font-size: 1.1em;
        }

        h1, h2, h3, h4, h5, h6{
            font-family: "Atkinson Hyperlegible";
        }


        a {
            transition: color .05s linear;
            color:#00B4CC;
        }

        a:hover {
            color:#00DFFC;
            text-decoration: none;
        }

        .navbar-custom {
            font-size: 22px;
            background-color: #202222 !important;
        }

        .navbar-custom .navbar-brand{
            font-size: 30px;
            color: #00dffc !important;
        }

        .navbar-custom .navitem{
            color:#00dffc !important;
        }

        .navitem:hover{
            color:#00b4cc !important;
            text-decoration: none;
        }
        
        /* External link cursor for Github and Twitter */
        .navbar-custom a[target="_blank"] {
            cursor: alias;
        }

        .hidden{
          display: none;
        }

        .navbar-toggler-icon {
          border: none;
          outline: none;
        }

        .caption{
            font-size:12px;
            text-align: center;
            font-style: italic;
            margin-bottom: .2em;
            margin-top: 1em;
        }


        hr{
            background-color:white !important;
        }

        .video-container {
          position: relative;
          width: 100%;
          padding-bottom: 56.25%;
        }

        .youtubevideo {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          border: 0;
        }

        code {
          font-family: Consolas,"courier new";
          color: #110000;
          background-color: #FAEADB;
          padding: 2px;
          font-size: 105%;
        }


        .addpic {
            display: block;
            margin-left: auto;
            margin-right: auto;
            max-width: 100%;
            border-radius: 0;
        }

</style>


    <link rel="icon" type="image/png" href=" /static/aklogo.png " />

        <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YNX5JQZWHT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YNX5JQZWHT');
</script>
<script data-goatcounter="https://kong.goatcounter.com/count"
                    async src="//gc.zgo.at/count.js"></script>
    
</head>



<body>


<nav class="navbar navbar-expand-md navbar-dark bg-dark navbar-custom">
    <a class="navbar-brand" aria-label="Link to homepage in the navbar" style="height:50px; padding-left:10px;" href="/"><img src="/static/aklogo.png" alt="Andy Kong's logo" height="50px" style="margin-top:0px;margin-bottom:10px" /></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon hidden" style="background-color:#00b4cc;">
      <i class="fab fa-buffer fa-2x" style="color:#00b4cc; ">
          </span>
        </i>
    </button>

    <div class="collapse navbar-collapse " id="navbarSupportedContent" style="margin-left:25px;margin-top:10px">
        <ul class="navbar-nav ml-auto navlinks">
            <li class="nav-item">
                <a class="nav-link navitem" href="https://github.com/kongmunist" target="_blank" title="Github">Github</a>
            </li>
            <li class="nav-item">
                <a class="nav-link navitem" href="https://twitter.com/oldestasian" target="_blank" title="twitter">Twitter</a>
            </li>
            <li class="nav-item"></li>
                <a class="nav-link navitem" href="/now/" >[Now]</a>
            </li>
            <li class="nav-item">
                <a class="nav-link navitem" href="/blog/" >[Blog]</a>
            </li>
        </ul>
    </div>
</nav>


<div style="height:100vh; width: 100vw; padding: 0px 1em 0px 1em;">
    <div style="max-width:50em; margin-bottom:4em; margin-left:auto; margin-right:auto;">
        
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

        


<!-- <div class="blogpage overflow-hidden" style="margin-bottom:4em;"> -->
<div class="blogpage overflow-hidden" style="max-width:50em; margin-bottom:4em; margin-left:auto; margin-right:auto;">
    <h1 class="title" style="margin-bottom:0px; margin-top:1em; font-size:2.5em;">Privacy screen</h1>
            <p style="font-size:0.8em;"> Published September 9, 2020</p>
<hr>
            <html><body><p>Howdy! I saw a meme when I was in high school that was a picture of a man. Superimposed onto his bottom text was the phrase "This meme is a red square when you're not looking," the joke being that you wouldn't be able to see it if you weren't looking. Anyway, since then I've had this desire to really implement it, to make some kind of billboard/house sign that nonresidents wouldn't be able to see, perhaps to display the weekly dinner schedule or WiFi password.</p>
<p>Using a Raspberry Pi, raspicam, and downloading dlib's face recognition models, we were able to get it to run at <b>0.5 FPS</b>. When someone it recognized from the "VIP Faces" folder was in view of the camera, it would turn the screen back on. Otherwise, the Raspberry Pi would black out the screen using some display power management functions invoked from the command. </p>
<p>This FPS is a little useless since it can't black out the screen fast enough, so I ported it over to my Mac. Here, it runs at \~10 FPS, so it can feasibly block out someone trying to view your screen. Another benefit is it blacks out the screen while you aren't looking at it (since it can't see your face), saving power (Assuming the display turn off and turn on don't cost any extra energy, which they probably do). Anyway, it only took a few hours to write, so here's all the code: </p>
<!-- HTML generated using hilite.me -->
<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">face_recognition</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">cv2</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">subprocess</span> <span style="color: #008800; font-weight: bold">as</span> <span style="color: #0e84b5; font-weight: bold">sp</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">os</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">glob</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">numpy</span> <span style="color: #008800; font-weight: bold">as</span> <span style="color: #0e84b5; font-weight: bold">np</span>
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">functools</span> <span style="color: #008800; font-weight: bold">import</span> <span style="color: #007020">reduce</span>

<span style="color: #888888"># Start webcam stream</span>
video_capture <span style="color: #333333">=</span> cv2<span style="color: #333333">.</span>VideoCapture(<span style="color: #0000DD; font-weight: bold">0</span>)

<span style="color: #888888"># Load approved users</span>
known_face_encodings <span style="color: #333333">=</span> <span style="color: #007020">dict</span>()

rootdir <span style="color: #333333">=</span> os<span style="color: #333333">.</span>path<span style="color: #333333">.</span>dirname(__file__) <span style="color: #333333">+</span> <span style="background-color: #fff0f0">"/faces/"</span>
<span style="color: #008800; font-weight: bold">for</span> fl <span style="color: #000000; font-weight: bold">in</span> os<span style="color: #333333">.</span>listdir(rootdir) :
    <span style="color: #008800; font-weight: bold">if</span> fl<span style="color: #333333">.</span>endswith(<span style="background-color: #fff0f0">".jpg"</span>) <span style="color: #000000; font-weight: bold">or</span> fl<span style="color: #333333">.</span>endswith(<span style="background-color: #fff0f0">".jpeg"</span>) <span style="color: #000000; font-weight: bold">or</span> fl<span style="color: #333333">.</span>endswith(<span style="background-color: #fff0f0">".png"</span>) :
        image <span style="color: #333333">=</span> face_recognition<span style="color: #333333">.</span>load_image_file(rootdir <span style="color: #333333">+</span> fl)
        known_face_encodings[fl] <span style="color: #333333">=</span> face_recognition<span style="color: #333333">.</span>face_encodings(image)[<span style="color: #0000DD; font-weight: bold">0</span>]
known_face_encodings <span style="color: #333333">=</span> <span style="color: #007020">list</span>(known_face_encodings<span style="color: #333333">.</span>values())

<span style="color: #888888"># Initialize some variables</span>
new_face_locations <span style="color: #333333">=</span> []
new_face_encodings <span style="color: #333333">=</span> []
turned_off <span style="color: #333333">=</span> <span style="color: #007020">False</span>
<span style="color: #008800; font-weight: bold">print</span>(<span style="background-color: #fff0f0">'Starting privacy screen'</span>)

<span style="color: #008800; font-weight: bold">while</span> <span style="color: #007020">True</span>:
    <span style="color: #888888"># Grab a single frame of video</span>
    ret, frame <span style="color: #333333">=</span> video_capture<span style="color: #333333">.</span>read()

    <span style="color: #888888"># Resize frame of video to 1/4 size for faster face recognition processing</span>
    small_frame <span style="color: #333333">=</span> cv2<span style="color: #333333">.</span>resize(frame, (<span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #0000DD; font-weight: bold">0</span>), fx<span style="color: #333333">=</span><span style="color: #6600EE; font-weight: bold">0.2</span>, fy<span style="color: #333333">=</span><span style="color: #6600EE; font-weight: bold">0.2</span>)

    <span style="color: #888888"># Convert the image from BGR color (which OpenCV uses) to RGB color (which face_recognition uses)</span>
    rgb_small_frame <span style="color: #333333">=</span> small_frame[:, :, ::<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>]

    <span style="color: #888888"># Find all the faces and face encodings in the current frame of video</span>
    new_face_locations <span style="color: #333333">=</span> face_recognition<span style="color: #333333">.</span>face_locations(rgb_small_frame)
    new_face_encodings <span style="color: #333333">=</span> face_recognition<span style="color: #333333">.</span>face_encodings(rgb_small_frame, new_face_locations)

    matched <span style="color: #333333">=</span> <span style="color: #007020">True</span>

    <span style="color: #888888"># Loop over each face found in the frame to see if it's someone we know.</span>
    <span style="color: #008800; font-weight: bold">for</span> new_face_encoding <span style="color: #000000; font-weight: bold">in</span> new_face_encodings:
        match <span style="color: #333333">=</span> face_recognition<span style="color: #333333">.</span>compare_faces(known_face_encodings, new_face_encoding)
        matched <span style="color: #333333">=</span> matched <span style="color: #000000; font-weight: bold">and</span> <span style="color: #007020">bool</span>(<span style="color: #007020">sum</span>(match))

    matched <span style="color: #333333">=</span> matched <span style="color: #000000; font-weight: bold">and</span> (<span style="color: #007020">len</span>(new_face_locations) <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>) <span style="color: #888888"># Make sure someone's there</span>


    <span style="color: #888888"># Depending on the state of matched, toggle the screen on or off</span>
    <span style="color: #008800; font-weight: bold">if</span> <span style="color: #000000; font-weight: bold">not</span> matched:
        <span style="color: #888888"># sp.run(["xset","dpms","force","off"]) # Debian, for Raspi</span>
        sp<span style="color: #333333">.</span>run([<span style="background-color: #fff0f0">"pmset"</span>, <span style="background-color: #fff0f0">"displaysleepnow"</span>]) <span style="color: #888888"># MacOS</span>
        turned_off <span style="color: #333333">=</span> <span style="color: #007020">True</span>
    <span style="color: #008800; font-weight: bold">elif</span> turned_off:
        turned_off <span style="color: #333333">=</span> <span style="color: #007020">False</span>
        <span style="color: #888888"># sp.run(["xset","dpms","force","on"]) # Debian, for Raspi</span>

        sp<span style="color: #333333">.</span>run([<span style="background-color: #fff0f0">"caffeinate"</span>, <span style="background-color: #fff0f0">"-u"</span>, <span style="background-color: #fff0f0">"-t"</span>, <span style="background-color: #fff0f0">"1"</span>]) <span style="color: #888888"># MacOS, has to run twice to be reliable</span>
        sp<span style="color: #333333">.</span>run([<span style="background-color: #fff0f0">"caffeinate"</span>, <span style="background-color: #fff0f0">"-u"</span>, <span style="background-color: #fff0f0">"-t"</span>, <span style="background-color: #fff0f0">"1"</span>])
</pre></td></tr></table></div>
<p><br/></p>
<p>That's all! Pretty simple program, but taught me some stuff about display power management and the trickiness of installing dlib. Also, writing this post taught me about HTML formatting (<a href="http://hilite.me/">hilite.me</a> is kinda nice)</p></body></html>



    
        <p style="line-height:250%;">
        <a class="btn btn-info" href="/tagged/facerecognition/">facerecognition</a>

        
            <a class="btn btn-info" href="/tagged/miniprojectlog/">miniprojectlog</a>
        
        </p> 
    
</div>




    </div>
    <br>
</div>


<script src="/static/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="/static/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="/static/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

</body>
</html>