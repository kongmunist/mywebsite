<!DOCTYPE html>
<html lang="en">
<head>

<!-- <title>
    Andy Kong!
</title> -->

<meta name="viewport" content="width=device-width, initial-scale=1.0">

    
        <meta name="author" content="Andy Kong">
        <meta name="title" content="iCloud Cleanup">
        <meta name="description" content="Script for highlighting large videos in iCloud and a storage discrepancy">
        <meta name="keywords" content=" javascript,  icloud,  storage,  mysteriesoflife, ">

        <title>
            iCloud Cleanup | Andy Kong
        </title>
    

    <style>
        body {
            counter-reset: h1counter h2counter;
        }

        h1:not(.title) {
            padding-left: 12px;
            margin-left: -12px;
            border-left: 8px ridge #DBAD80;

            counter-reset: h2counter;
        }

        h1:not(.title)::before {
            counter-increment: h1counter;
            content: counter(h1counter) ". ";
        }

        h2::before {
            counter-increment: h2counter;
            content: counter(h1counter) "." counter(h2counter) " ";
        }

    </style>




    <style type="text/css">
        /* Atkinson Hyperlegible */
        /* latin-ext
        @font-face {
          font-family: 'Atkinson Hyperlegible';
          font-style: normal;
          font-weight: 400;
          src: url("/static/atkhyp_latext.woff2") format('woff2');
          unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
        } */
        /* latin */
        @font-face {
          font-family: 'Atkinson Hyperlegible';
          font-style: normal;
          font-weight: 400;
          src: url("/static/atkhyp_lat.woff2") format('woff2');
          unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
        }


        /* Ubuntu */
        /* latin-ext
        @font-face {
          font-family: 'Ubuntu';
          font-style: normal;
          font-weight: 400;
          src: url("/static/ubuntu_latext.woff2") format('woff2');
          unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
        } */
        /* latin */
        @font-face {
          font-family: 'Ubuntu';
          font-style: normal;
          font-weight: 400;
          src: url("/static/ubuntu_lat.woff2") format('woff2');
          unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
        }
    </style>

    <!-- Bootstrap -->
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous"> -->
    <link rel="stylesheet" type="text/css" href="/static/bootstrap.min.css">

    <script src="/static/fontawesome.js" defer></script>
    <!-- <script src="https://kit.fontawesome.com/c62dcd5933.js"></script> -->

    <!-- Instant Page inlined - source is instant.page/5.1.0 -->
    <script src="/static/instantpage-5.1.0.js" type="module" defer></script>




    <style>
body {
    background: #202222;
    font-size: 1.2em;
    font-family: 'Ubuntu', sans-serif;
}

.navlinks{
    font-family: 'Atkinson Hyperlegible';
    font-size: 1.2em;
}

h1, h2, h3, h4, h5, h6{
    font-family: "Atkinson Hyperlegible";
}


a {
    transition: color .2s linear;
    color:#00B4CC;
}

a:hover {
    color:#00DFFC;
    text-decoration: none;
}

.navbar-custom {
    font-size: 22px;
    background-color: #202222 !important;
}

.navbar-custom .navbar-brand{
    font-size: 30px;
    color: #00dffc !important;
}

.navbar-custom .navitem{
    color:#00dffc !important;
}

.navitem:hover{
    color:#00b4cc !important;
    text-decoration: none;
}

.hidden{
  display: none;
}

.navbar-toggler-icon {
  border: none;
  outline: none;
}

.caption{
    font-size:12px;
    text-align: center;
    font-style: italic;
    margin-bottom: .2em;
    margin-top: 1em;
}

.projectpage img{
    max-width: 100%;
    max-height: 50vh;
    height: auto;
    width: auto;
}

.blogpage img{
    max-width: 100%;
    max-height: 50vh;
    height: auto;
    width: auto;
    display: block !important;
    margin: 0 auto !important;
}

.blogpage h1, .blogpage h2{
    color: #E0B890;
}

.projectpage h1, .projectpage h2{
    color: #E0B890;
}

hr{
    background-color:white !important;
}

.video-container {
  position: relative;
  width: 100%;
  padding-bottom: 56.25%;
}

.youtubevideo {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: 0;
}

code {
  font-family: Consolas,"courier new";
  color: #110000;
  background-color: #AFAFAF;
  padding: 2px;
  font-size: 105%;
}

</style>

    <link rel="icon" type="image/png" href=" /static/aklogo.png " />

        <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YNX5JQZWHT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YNX5JQZWHT');
</script>
<script data-goatcounter="https://kong.goatcounter.com/count"
                    async src="//gc.zgo.at/count.js"></script>
    
</head>



<body style="color:#FAEADB;overflow-x: hidden;">



<nav class="navbar navbar-expand-md navbar-dark bg-dark navbar-custom">
    <a class="navbar-brand" aria-label="Link to homepage in the navbar" style="height:50px; padding-left:10px;" href="/"><img src="/static/aklogo.png" alt="Andy Kong's logo" height="50px" style="margin-top:0px;margin-bottom:10px" /></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon hidden" style="background-color:#00b4cc;">
      <i class="fab fa-buffer fa-2x" style="color:#00b4cc; ">
          </span>
        </i>
    </button>

    <div class="collapse navbar-collapse " id="navbarSupportedContent" style="margin-left:25px;margin-top:10px">
        <ul class="navbar-nav ml-auto navlinks">
            <li class="nav-item">
                <a class="nav-link navitem" href="/static/AndyKongCV.pdf ">CV/Resume</a>
            </li>
            <li class="nav-item">
                <a class="nav-link navitem" href="https://github.com/kongmunist" target="_blank" title="Github">GitHub</a>
            </li>
            <li class="nav-item">
                <a class="nav-link navitem" href="https://twitter.com/oldestasian" target="_blank" title="Twitter">Twitter</a>
            </li>
            <li class="nav-item">
                <a class="nav-link navitem" href="mailto:andyking99@gmail.com" target="_blank" title="Email">Email</a>
            </li>


            <li class="nav-item">
                <a class="nav-link navitem" href="/blog/">[Blog]</a>
            </li>
        </ul>
    </div>
</nav>


    <div class="row justify-content-center" style = "height:100vh; width: 100vw; padding-left:30px; padding-right:0px;">
<!-- padding-left:20px; padding-right:20px -->
            <div class="col-md-8 col-11 p-0" style="">
                <!-- <div class="container-fluid img-rounded shadow-lg px-4 d-flex " style="padding-top:20px;padding-bottom:20px;  border-radius:20px;text-overflow:ellipsis;width:100%;"> -->

                
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

        


<div class="blogpage overflow-hidden" style="margin-bottom:4em;">
    <h1 class="title" style="margin-bottom:0px; margin-top:1em; font-size:2.5em;">iCloud Cleanup</h1>
            <p style="font-size:0.8em;"> Published June 6, 2023</p>
<hr>
            <p>Hello!</p>
<p>Recently I received an email from Apple letting me know that my iCloud storage was full. </p>
<p class ="caption"> Kind letter from Apple requesting I purchase more storage </p>
<p><img loading="lazy" style="display: block; margin-left: auto;margin-right: auto;"  alt="Kind letter from Apple requesting I purchase more storage" src="/static/ic_appleemail.jpg" /></p>

<p>Since the cost of 200GB vs. 1TB jumps more than threefold, I embarked on a great exploration of alternatives. Since photos made up the majority of my storage (~127GB), I figured I could just go into my Photos album and click Sort By File Size.</p>
<p>...</p>
<p>Except this is not a feature offered by Apple. It's not even a feature in the iCloud browser. I guess it's a bit too technical for Apple Photos, and unfortunately it would also make it too easy to avoid paying for more iCloud storage. </p>
<p>Whatever the reason, I still wanted to go through my photos by file size. Several apps exist for going through your photos and highlighting duplicates, or into your videos and showing you the file size. The only problem â€” photos that have been offloaded to iCloud do not show up in these apps, so they're not actually super useful. Also, would you really want random apps to scan through all your photos? </p>
<p class ="caption"> Screenshot from a photo file size viewing app, with non-downloaded photos represented as 0B </p>
<p><img loading="lazy" style="display: block; margin-left: auto;margin-right: auto;"  alt="Screenshot from a photo file size viewing app, with non-downloaded photos represented as 0B" src="/static/ic_photosbysize.png" /></p>

<h2>Janky JS solution</h2>
<p>Instead, I went to the iCloud website and thought about what was possible. I navigated to Photos-&gt;Media Types-&gt;Videos, and zoomed out as far as I could. </p>
<p class ="caption"> Videos anonymized by slow internet loading </p>
<p><img loading="lazy" style="display: block; margin-left: auto;margin-right: auto;"  alt="Videos anonymized by slow internet loading" src="/static/ic_icloudphotos.png" /></p>

<p>We can see that each video has an accompanying duration box â€” as long as it's an HTML element, we can use JS to search and filter them. I found that every runtime box has the class <code>video-text-badge</code>. From there is was a simple matter to find all of them in the page, sort by their duration, and highlight the ones that were past some threshold. Here's the code:</p>
<script src="https://gist.github.com/kongmunist/a598bcdd8c226c3a3159b1a918344977.js"></script>

<p>Because iCloud only loads the elements that are on the page, I've made this into a function that runs on a timer so new elements get highlighted as they get scrolled into. Here's what it looks like:</p>
<p class ="caption"> Videos bigger than 20s are surrounded by a red box, making them much easy to pick out </p>
<p><img loading="lazy" style="display: block; margin-left: auto;margin-right: auto;"  alt="Videos bigger than 20s are surrounded by a red box, making them much easy to pick out" src="/static/ic_icloudphotoshighlighted.png" /></p>

<p>To use it, just open the Javascript console (right click page -&gt; Inspect Element) and paste in the entire gist. Now you can easily select multiple big videos from iCloud and download them before deleting, moving them into longer-term storage: secret HDD under your mattress, other cloud storage, etc etc. </p>
<hr>

<h1>The Mystery</h1>
<p>So, I used this script to remove all my iCloud videos &gt;30s. The interesting thing is, after I had removed all the "big videos" and downloaded them, it cleared ~55GB from my iCloud <em>despite only downloading 7GB of videos.</em> Herein lies the mystery.</p>
<p class ="caption"> All downloaded videos take up 8GB of disk space </p>
<p><img loading="lazy" style="display: block; margin-left: auto;margin-right: auto;"  alt="All downloaded videos take up 8GB of disk space" src="/static/ic_dl1info.png" /></p>

<p class ="caption"> iCloud storage reduces from 199GB to 143GB after downloading 7GB of videos </p>
<p><img loading="lazy" style="display: block; margin-left: auto;margin-right: auto;"  alt="iCloud storage reduces from 199GB to 143GB after downloading 7GB of videos" src="/static/ic_dl1afterdelete.png" /></p>

<p>Somehow, those 7GB of video took up way more space in the cloud than on my hard drive. Interesting...</p>
<h1>Experiment 1</h1>
<p>I wanted to test this further. First, I uploaded a 4K video with a lot of motion. This took up 281 MB. My storage looked like this after uploading it:</p>
<p class ="caption"> 4K video uploaded, iCloud says 145.33 GB used </p>
<p><img loading="lazy" style="display: block; margin-left: auto;margin-right: auto;"  alt="4K video uploaded, iCloud says 145.33 GB used" src="/static/ic_dl2storagebefore.png" /></p>

<p>Then I downloaded it and deleted it. The file was still 281 MB. Here is the storage afterwards:</p>
<p class ="caption"> 4K video deleted, iCloud says 145.6 GB used </p>
<p><img loading="lazy" style="display: block; margin-left: auto;margin-right: auto;"  alt="4K video deleted, iCloud says 145.6 GB used" src="/static/ic_dl2storageafter.png" /></p>

<p>Removing a 281MB video frees up ~270MB. This adds up, which is puzzling. What about the other, older videos? </p>
<h1>Experiment 2</h1>
<p>I thought that maybe older videos could have multiple copies saved in iCloud, so I searched through my videos to see if I could find a shorter one that takes up a lot of storage space. I found one with a lot of graphs, iCloud said it took up 128 MB.</p>
<p class ="caption"> Older big video that takes up 128 MB </p>
<p><img loading="lazy" style="display: block; margin-left: auto;margin-right: auto;"  alt="Older big video that takes up 128 MB" src="/static/ic_dl3icloudinfo.png" /></p>

<p>When I downloaded it, the file was only 47 MB!</p>
<p class ="caption"> Downloaded video file is 47 MB </p>
<p><img loading="lazy" style="display: block; margin-left: auto;margin-right: auto;"  alt="Downloaded video file is 47 MB" src="/static/ic_dl3download.png" /></p>

<p>And here is my iCloud storage before and after</p>
<p class ="caption"> iCloud storage before deleting the old video, 145.29 GB used </p>
<p><img loading="lazy" style="display: block; margin-left: auto;margin-right: auto;"  alt="iCloud storage before deleting the old video, 145.29 GB used" src="/static/ic_dl3storagebefore.png" /></p>
<p class ="caption"> iCloud storage before deleting the old video, 145.12 GB used, reduction of 170MB </p>
<p><img loading="lazy" style="display: block; margin-left: auto;margin-right: auto;"  alt="iCloud storage before deleting the old video, 145.12 GB used, reduction of 170MB" src="/static/ic_dl3storageafter.png" /></p>

<p>So iCloud says the video is 128MB, I download it and the video is actually 48MB, and my free storage increases by ~170MB when I deleted it. Interesting!</p>
<h1>Conclusion</h1>
<p>It's weird that my storage freed up more than 7x the removed files size, and weirder still that old, big videos appear to have a much larger storage footprint in iCloud than in real life. </p>
<p>I am mildly interested in finding out why this happens, but I am not interested/bored enough to do it myself. If one of you fine people figure it out, please let me know by emailing me.</p>
<p>Anyway, I have freed up &gt;50GB to fill with more inane videos, and written a small script that allows me to do it again in the future. Hope this proves helpful to you, dear reader.</p>
<p>Cya later!</p>



    
        <hr>
        <p style="line-height:250%;">
        <a class="btn btn-info" href="/tagged/javascript/">javascript</a>

        
            <a class="btn btn-info" href="/tagged/icloud/">icloud</a>
        
            <a class="btn btn-info" href="/tagged/storage/">storage</a>
        
            <a class="btn btn-info" href="/tagged/mysteriesoflife/">mysteriesoflife</a>
        
        </p> 
    
</div>




                    </div>
                    <br>
        <!-- </div> -->
</div>




<!--<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>-->
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>-->
<!--<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>-->
<!--<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>-->
<script src="/static/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>-->
<script src="/static/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<!--<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>-->
<script src="/static/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

</body>
</html>